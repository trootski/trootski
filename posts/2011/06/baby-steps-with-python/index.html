<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>trootski | Baby steps with Python</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/styles.css rel=stylesheet><script type=application/javascript src=/main.js></script></head><body><header class="cover bg-top" style=background-image:url(http://localhost:1313/images/other-python-icon.png)><div class="pb3-m pb6-l bg-black-60"><nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-primary"><div class=container><a href=http://localhost:1313/ class=navbar-brand>trootski</a>
<button class="navbar-toggle d-xs-block d-md-none" type=button data-toggle=toggle data-target=#mainNavAltContent aria-controls=mainNavAltContent aria-expanded=false aria-label="Toggle Navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=mainNavAltContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/ title="Blog page">Blog</a></li><li class=nav-item><a class=nav-link href=/work title="Work page">Work</a></li><li class=nav-item><a class=nav-link href=/about title="About page">About</a></li></ul><ul class="navbar-nav d-flex flex-row"><li class=nav-item><a href=https://twitter.com/trootski target=_blank class="link-transition twitter" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></li><li class=nav-item><a href=https://www.linkedin.com/in/troot1/ target=_blank class="link-transition linkedin" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></li><li class=nav-item><a href=https://github.com/trootski target=_blank class="link-transition github" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" ><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></a></li></ul></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Baby steps with Python</h1></div></div></header><div class=container><div class=row><div class="col-12 col-md-3" role=navigation><div class=sidebar-holder><div class=sidebar-inner><p>This is a sidebar placeholder</p></div></div></div><main class="col-12 col-md-8" role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=http://localhost:1313/posts/2011/06/baby-steps-with-python/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=http://localhost:1313/posts/2011/06/baby-steps-with-python/&text=Baby%20steps%20with%20Python" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:1313/posts/2011/06/baby-steps-with-python/&title=Baby%20steps%20with%20Python" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Baby steps with Python</h1><time class="f6 mv4 dib tracked" datetime=2011-06-05T00:00:00Z>June 5, 2011</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Started out playing around with Python as a scripting tool. Have to say, it really is a neat mix of the kinda power and libraries I&rsquo;m used to with Perl and the flexibility of a pure scripting language.</p><p>Just for a giggle, I decided to re-write my <a href=http://troot.org/2009/08/daily-filing/ title="Daily backup and filing">C# backup script</a> to backup some of my mac folders. Most of the language I&rsquo;m still getting my head around. 4 times out of ten, each line gets a semi-colon. I&rsquo;m using PyDev on Aptana.</p><p>Here&rsquo;s the code I ended up with:</p><p>[sourcecode language="python&rdquo;] '&rsquo;&rsquo; Created on Apr 4, 2011</p><p>This script is designed to take all the files from one directory and move them to another date stamped folder. This reduces the amount of clutter on certain key folders which have a high amount of files created in them</p><p>@author: troot '&rsquo;&rsquo;</p><p>import os from datetime import date import re import urllib from xml.dom import minidom, Node import shutil</p><p>class ArchiveFolders():</p><p>def __init__(self, **kwargs):</p><p>self.properties = kwargs</p><p>self.properties[&lsquo;slash_char&rsquo;] = self._get_slash_char()</p><p>if self.xml_config_url is None: self.properties[&lsquo;xml_config_url&rsquo;] = "../archive_config.xml"</p><p>'&rsquo;&rsquo; Run the archiving process '&rsquo;&rsquo; def run(self):</p><p>try: self.properties[&lsquo;config_dom&rsquo;] = minidom.parse(urllib.urlopen(self.xml_config_url)) except IOError: print "Couldn&rsquo;t find the configuration file. Please check the value and try again." exit()</p><p>for ark in self._next_ark_config():</p><p>try: self.properties[&lsquo;conf&rsquo;] = self._process_ark_config(ark) except ValueError: print "There is an error in the xml config. Please check the file and try again"</p><p>self._create_src_folders(self.conf.src_dir)</p><p>self.conf.dest_dir = self._create_archive_folders(self.conf.dest_dir)</p><p>self._execute_archiving(self.conf.src_dir, self.conf.dest_dir, self.slash_char)</p><p>'&rsquo;&rsquo; Loop through the src_dir and move each of its files/folders to the dest_dir (ignore hidden files) '&rsquo;&rsquo; def _execute_archiving(self, src_dir, dest_dir, slash_char):</p><p>srcFolderContents = os.listdir(src_dir) startDotREGEX = re.compile("^.")</p><p>for file in srcFolderContents: if not startDotREGEX.match(file) and not file in self.conf.ignore: print "%s%s%s" % (dest_dir, slash_char, file) shutil.move( "%s%s%s" % (src_dir, slash_char, file), "%s%s%s" % (dest_dir, slash_char, file) )</p><p>'&rsquo;&rsquo; Check the src_dir exists. If it doesn&rsquo;t, create it '&rsquo;&rsquo; def _create_src_folders(self, src_dir): try:</p><p>if not os.path.exists(src_dir): os.makedirs(src_dir)</p><p>except OSError as oe: print "Error creating the source folder. Please ensure you have permission to write the folder below." % oe exit()</p><p>'&rsquo;&rsquo; Create the dest_dir folder into which the files will be moved '&rsquo;&rsquo; def _create_archive_folders(self, dest_dir):</p><p>try:</p><p>if not os.path.exists(dest_dir): raise OSError</p><p>month_date_stub = date.today().strftime("%Y_%m") day_date_stub = date.today().strftime("%Y_%m_%d") lst_dest_dir = [month_date_stub, day_date_stub]</p><p>dest_dir = "%s%s%s" % (dest_dir, self.slash_char, self.slash_char.join(i for i in lst_dest_dir))</p><p>if not os.path.exists(dest_dir): os.makedirs(dest_dir)</p><p>return dest_dir</p><p>except OSError as oe: print "Error creating the destination folder. Please ensure you have permission to the folder below.n%s" % oe exit()</p><p>'&rsquo;&rsquo; Read in the xml config (archive_config.xml) and save the settings '&rsquo;&rsquo; def _next_ark_config(self): for node in self.config_dom.getElementsByTagName("ark"): yield node return</p><p>'&rsquo;&rsquo; Take an ark node and loop through the info inside '&rsquo;&rsquo; def _process_ark_config(self, ark):</p><p>ark_config = ArkConfig() self._remove_whitespace_nodes(ark) for node in ark.childNodes: if node.nodeType == Node.ELEMENT_NODE: if node.nodeName.lower() == "src_config": for src_node in node.childNodes: if src_node.nodeName.lower() == "src_dir": ark_config.set_property(&lsquo;src_dir&rsquo;, self._get_node_text(src_node.childNodes)) elif src_node.nodeName.lower() == "ignore": ark_config.ignore.append(self._get_node_text(src_node.childNodes)) if node.nodeName.lower() == "dest_dir": ark_config.set_property(&lsquo;dest_dir&rsquo;, self._get_node_text(node.childNodes))</p><p>return ark_config</p><p>'&rsquo;&rsquo; Given a particular node, get its text value '&rsquo;&rsquo; def _get_node_text(self, node): retVal = "" for child in node: if child.nodeType == Node.TEXT_NODE: retVal = retVal + child.data elif child.nodeType == Node.CDATA_SECTION_NODE: retVal = retVal + child.data elif child.hasChildNodes(): retVal = retVal + self._get_node_text(child.childNodes) return retVal</p><p>'&rsquo;&rsquo; Take white spaces out of the xml structure (they make traversing more difficult) '&rsquo;&rsquo; def _remove_whitespace_nodes(self, node, unlink=False): remove_list = [] for child in node.childNodes: if child.nodeType == Node.TEXT_NODE and not child.data.strip(): remove_list.append(child) elif child.hasChildNodes(): self._remove_whitespace_nodes(child, unlink) for node in remove_list: node.parentNode.removeChild(node) if unlink: node.unlink()</p><p>'&rsquo;&rsquo; Set what the folder delimeter should be '&rsquo;&rsquo; def _get_slash_char(self): if os.name == "nt": return "\" else: return "/"</p><p>@property def slash_char(self): return self.properties.get(&lsquo;slash_char&rsquo;, None)</p><p>@property def conf(self): return self.properties.get(&lsquo;conf&rsquo;, None)</p><p>@property def xml_config_url(self): return self.properties.get(&lsquo;xml_config_url&rsquo;, None)</p><p>@property def config_dom(self): return self.properties.get(&lsquo;config_dom&rsquo;, None)</p><p>class ArkConfig():</p><p>def __init__(self, **kwargs): self.properties = kwargs self.properties[&lsquo;ignore&rsquo;] = []</p><p>def __repr__(self): return "ArkConfig (src_dir: %s, dest_dir: %s, ignore: %s" % (self.src_dir, self.dest_dir, self.ignore)</p><p>def set_property(self, prop, val): self.properties[prop] = val</p><p>@property def src_dir(self): return self.properties.get(&lsquo;src_dir&rsquo;, None)</p><p>@property def dest_dir(self): return self.properties.get(&lsquo;dest_dir&rsquo;, None) @dest_dir.setter def dest_dir(self, val): self.properties[&lsquo;dest_dir&rsquo;] = val @dest_dir.deleter def dest_dir(self): del self.properties[&lsquo;dest_dir&rsquo;]</p><p>@property def ignore(self): return self.properties.get(&lsquo;ignore&rsquo;, None)</p><p>if __name__=="__main__": bf = ArchiveFolders() bf.run()</p><p>[/sourcecode]</p><p>And then the config file has the format:</p><p>[sourcecode language="xml&rdquo;] &lt;?xml version="1.0" encoding="utf-8"?> &lt;config> &lt;ark> &lt;src_config> &lt;src_dir>&lt;![CDATA[c:UserstrootDesktop_today]]>&lt;/src_dir> &lt;ignore>&lt;![CDATA[ignore_1.txt]]>&lt;/ignore> &lt;ignore>&lt;![CDATA[ignore_2.txt]]>&lt;/ignore> &lt;/src_config> &lt;dest_dir>&lt;![CDATA[c:UserstrootDocumentsRestore_today]]>&lt;/dest_dir> &lt;/ark> &lt;ark> &lt;src_config> &lt;src_dir>&lt;![CDATA[C:UserstrootDownloads]]>&lt;/src_dir> &lt;/src_config> &lt;dest_dir>&lt;![CDATA[C:UserstrootDocumentsRestoreDownloads]]>&lt;/dest_dir> &lt;/ark> &lt;/config> [/sourcecode]</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main></div></div></body></html>